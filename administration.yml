include: [navigator,datatable,document]

administration:
  type: navigator
  default: { url: /audit_trail/user_list}
  items:
    - users
    - manage_all_users: {access: admin, partner_access: merchant }
    - add_user: {access: admin, action: dialog}
    - vspace
    - $heading: { name: Accounts,access: [admin],partner_access: merchant }
    - prepaid
    - post_paid: {name: Postpaid}
    - pending_approvals: {name: Pending Approvals}
    - vspace
    - $heading: {name: User Groups,access: [admin],partner_access: [post_paid,existing_account,company]}
    - all_user_groups: {partner_access: [post_paid,company]}
    - add_user_group: {partner_access: [post_paid,company]}
    - vspace
    - $heading: { name: Audit }
    - my_audit_trail
    - organisation_audit_trail
    - system_audit_trail
    - vspace
    - $heading: { name: Rates }
    - add_rate: {name: Add Credit Rate,action: dialog}
    - view_rates: {name: View Credits Rates}
    - manage_rates: {name: Manage Credits Rates}


prepaid:
  access: [admin,finance]
  partner_access: merchant
  url: /administration/prepaid
  type: list
  row_actions:
    - activate: {class: [green]}
    - deactivate: {class: [red]}
  values:
    - collection.data: [partner,[type: '/in("company","individual")'],identifier,create_time,name,cellphone,email,active: "/if(active,'Yes','No')",style: '/if(active,"active","inactive")',actions: '/if(active,"slide,deactivate","slide,activate")',active]

post_paid:
  access: [admin,finance]
  partner_access: merchant
  url: /administration/post_paid
  type: list
  row_actions:
    - activate: {class: [green]}
    - deactivate: {class: [red]}
    - set_post_paid_rate: {name: Set Rate,class: [orange],action: dialog}
  values:
    - collection.data: [partner,[type: 'post_paid'],identifier,create_time,name,cellphone,email,active: "/if(active,'Yes','No')",style: '/if(active,"active","inactive")',actions: '/if(active,"slide,deactivate,set_post_paid_rate","slide,activate")',active]
  on_activateAdministration: ~this.trigger('refresh')
  on_deactivateAdministration: ~this.trigger('refresh')

pending_approvals:
  access: [admin,finance]
  partner_access: merchant
  name: Outstanding Post Paid Approvals
  url: /administration/pending_approvals
  type: list
  row_actions:
    - action: dialog
    - approve: {class: [green]}
    - decline: {class: [red]}
  values:
    - collection.data: [partner,[type: 'existing_account'],identifier,create_time,name,cellphone,email,active: "/if(active,'Yes','No')",style: '',actions: '/"slide,approve,decline"',active]
  on_approveAdministration: ~this.trigger('refresh')
  on_declineAdministration: ~this.trigger('refresh')

list:
  type: datatable
  class: [widest]
  body: {max-height: 800px}
  flags: [show_titles, filter]
  sort: time_added
  sort_order: desc
  fields:
    - key: {show: no}
    - time_added: {width: 23%}
    - partner: {width: 20%, class: [truncate-word]}
    - cellphone: {width: 17%}
    - email: {width: 25%, class: [truncate-word]}
    - active: {width: 10%}
    - style
    - actions: {width: 0% }
  defaults:
    style: none

approve:
  url: /rate/set_post_paid_rate
  confirmation: yes

approval_email:
  from: $support_email
  to: $partner_name <$email>
  subject: Account approval
  message: >
    Dear <b>$partner_name</b> <br><br>
    Your account on $program_name has been approved. Please note that we have the following payment methods available<br>
    Credit Card<br>
    Bank Deposit<br>
    Purchase Order(For client that have agreed terms and conditions with the service provider)<br><br>
    Regards,<br><br>
    <b>Customer Operations</b>

decline:
  url: /administration/decline
  desc: Please state your reason for declining this account.
  type: input_page
  modal:
    dialog: { class: [col s12 m10 l6] }
  inputs:
    - reason: {type: textarea,valid: [provided], class: [brand-font]}
  actions:
    - decline
    - cancel: {action: close_dialog}
  post:
    - collection.values: [partner,$key,client_name: name,email]
    - collection.update: [partner,$key,type: company]
    - emailer.send: {type: rejection_email}
    - trigger: declineAdministration
    - close_dialog: Application Declined
  audit:
    action: Decline Existing Account Registration
    detail: Declined client $client_name

rejection_email:
  from: $support_email
  to: $client_name <$email>
  subject: Rejection of account registration
  message: >
    Dear <b>$client_name</b> <br><br>
    Your request to register as an existing account holder on the $program_name system was declined due to $reason<br>
    You are now registered as a company with the same access as an existing account, except for buying credits via purchase order method.<br><br>
    Please contact the Administrator for more information.<br><br>
    Regards,<br><br>
    <b>Customer Operations</b>

activate:
  access: [admin,finance]
  partner_access: merchant
  post:
    - collection.update: [partner,$key,active: 1]
    - collection.values: [partner,$key,partner_name: name,email]
    - emailer.send: { type: activation_email }
    - trigger: [setRowData,"",$key,{active: 'Yes',style: 'active',actions: 'slide,deactivate,set_postpaid_rate'}]
    - close_dialog: Account Activated

activation_email:
  from: $support_email
  to: $partner_name <$email>
  subject: Account Activation
  message: >
    Dear <b>$partner_name</b> <br><br>
    Your account has been activated on $program_name,You will now be able to use purchase order payment method<br><br>
    Regards,<br><br>
    <b>Customer Operations</b>

deactivate:
  confirmation: yes
  access: [admin,finance]
  partner_access: merchant
  post:
    - collection.update: [partner,$key,active: 0]
    - collection.values: [partner,$key,partner_name: name,email]
    - emailer.send: { type: deactivation_email }
    - trigger: [setRowData,"",$key,{active: 'No',style: 'inactive',actions: 'slide,activate'}]
    - close_dialog: Account Deactivated

deactivation_email:
  from: $support_email
  to: $partner_name <$email>
  subject: Account Deactivation
  message: >
    Dear <b>$partner_name</b> <br><br>
    Your account has been deactivated on $program_name,You will not be able to use purchase order payment method but all other system function will be availabe to you<br><br>
    For more information, please contact the Administrator<br><br>
    Regards,<br><br>
    <b>Customer Operations</b>
