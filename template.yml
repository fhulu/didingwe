include: [datatable]

add:
  url: /template/add
  name: Add new template
  type: input_page
  modal:
    dialog: {class: [col s12 m8 l7]}
  inputs:
    - template_name
    - tags: { type: container }
    - template_message: { type: textarea}
    - access_level: { type: radiogroup}
  actions:
    - add: { name: Save }
  post:
    - collection.insert: [message_template, name: $template_name, message: $template_message,access_level]
    - trigger: addTemplate
    - close_dialog: Template Addded Successfully
  audit:
    action: Added new template
    detail: $template_name $template_message

tags:
  contents:
    - type: tag_button
    - collection.data: [template_tag, [active, partner], tag]

tag_button:
  type: button
  action: trigger
  event:
    name: addTag
    parameters: [$id]
    sink: "#template_message"

template_message:
  class: [height-line-8,shadow]
  on_addTag: ~function(e,tag) { $(this).insertAtCursor('<' + tag + '>'); }

list:
  type: datatable
  flags: [show_titles,filter]
  body: { max-height: 180 }
  class: [widest  ]
  sort: create_time
  fields:
    - key: { show: false }
    - time_created
    - name
    - message
    - access_level
    - actions
  row_actions:
    - edit: { action: dialog }
    - delete
  values:
    - collection.values: [session, $sid, partner, owner: user, active: /1]
  on_addTemplate: ~this.trigger('refresh')
  on_editTemplate: ~this.trigger('refresh')
  on_deleteTemplate: ~this.trigger('refresh')


list_all:
  name: View all templates
  type: list
  fields:
    - owner: { push: access_level }
  values:
    - collection.data:
        - message_template
        - [active,partner]
        - identifier
        - create_time
        - name
        - message
        - user.email
        - access_level
        - actions: /("slide,edit,delete")

list_own:
  name: View own templates
  type: list
  values:
    - collection.data:
        - message_template
        - [owner, active,user]
        - identifier
        - create_time
        - name
        - message
        - access_level
        - actions: /("slide,edit,delete")

edit:
  url: /template/edit
  type: input_page
  modal:
    dialog: {class: [col s12 m8 l7]}
  inputs:
    - template_name
    - tags: { type: container }
    - template_message: { type: textarea }
    - access_level: { type: radiogroup}
  actions:
    - edit: {name: Save Changes}
  values:
    - collection.values: [message_template, $key,template_name: name,template_message: message,access_level]
  post:
    - collection.update: [message_template,$key,delta,name: $template_name,message: $template_message]
    - trigger: editTemplate
    - close_dialog: Changes Saved Successfully
  audit:
    action: Updated Template
    detail: $template_name $template_message


delete:
  url: /template/delete
  confirmation: yes
  post:
    - collection.update: [message_template,$key,active: 0]
    - trigger: deleteTemplate
  audit:
    action: Deleted Template
    detail: $template_name
