(function(e){"use strict";e.fn.exists=function(){return this.get(0)!=undefined};e.fn.hasAttr=function(e){return this.attr(e)!==undefined};e.fn.filterText=function(t){return this.filter((function(){return e(this).text()==t}))};e.fn.setValue=function(t){if(e.isArray(t))return this;if(e.isPlainObject(t)){var i=this;e.each(t,(function(t,r){switch(t){case"value":i.setValue(r);break;case"class":i.setClass(r);break;case"children":e.each(r,(function(e,t){i.find(e).setValue(t)}));break;default:i.attr(t,r)}}))}if(this.hasAttr("template"))t=this.attr("template").replace(/\$value/,t);if(this.is("a")){if(t==null)t="";return this.attr("href",t)}var r=this.attr("type");if(r==="checkbox"){var n=this.attr("values");if(n!="")t=n.indexOf(t);return this.prop("checked",t)}if(r=="radio"){var a=this.closest(".radiogroup");var s=a.find("[type=radio][name='"+this.attr("name")+"'][value='"+t+"']");s.prop("checked",true);return this}if(this.is("select")){this.val(t);if(this.val()==t)return this;var o=this.children("option").filterText(t);if(!o.exists())return this;if(this.attr("server")==t)this.attr("server",o.val());this.val(o.val());return this}if(typeof t=="string")t=dd.escapeHtml(t,this.attr("parseHtml"),this.attr("escapeHtml"));if(this.hasAttr("value"))return this.attr("value",t).val(t);return this.html(t)};e.fn.getValue=function(){var e=this.attr("type");if(e==="checkbox"){var t=this.is(":checked")?1:0;var i=this.attr("values");if(i=="")return t;return i.split(",")[t]}if(e==="radio")return this.filter(":checked").val();if(this.is("input,select,textarea"))return this.val();return this.is("[value]")?this.attr("value"):this.text()};e.fn.value=function(e){if(e===undefined)return this.getValue();return this.setValue(e)};e.fn.updateCheckGroupValue=function(){var t=[];this.find("input[type=checkbox]").each((function(){if(e(this).is(":checked"))t.push(e(this).attr("check"))}));return this.attr("chosen",t.join())};e.fn.values=function(){this.find(".checkgroup").updateCheckGroupValue();var t={};var i=[];this.filter("input,textarea,select,.checkgroup,:not(option)[value]").each((function(){var r=e(this);var n=r.hasAttr("name")?r.attr("name"):r.attr("id");if(n===undefined||n.trim()=="")return true;var a;if(r.hasClass("checkgroup"))a=r.attr("chosen");else if(r.attr("type")==="radio"){if(!r.is(":checked"))return;a=r.attr("value")}else a=r.value();var s=r.attr("server");if(s!==undefined&&s!=a)i.push(n);t[n]=a}));t.delta=i.join();return t};e.fn.send=function(t,i,r){if(i instanceof Function){r=i;i=undefined}var n=e(this).values();if(i!==undefined)n=e.extend({},i.data,n);i=e.extend({},i,{data:n});return dd.send(t,i,r)};e.fn.json=function(t,i,r){if(i instanceof Function){r=i;i=undefined}var n=e(this).values();var a=i.post_prefix;if(a){delete i.post_prefix;var s={};e.each(n,(function(e,t){if(e=="delta")return;s[a+e]=t}));n=s}if(i!==undefined)n=e.extend({},i.data,n);i=e.extend({},i,{data:n});e.json(t,i,(function(e){r(e)}));return this};e.fn.setChildren=function(t,i){var r=this;if(t===null)return;e.each(t,(function(e,t){var n=r.find("#"+e+",[name='"+e+"']");if(i)n.attr("server",t);n.setValue(t)}));return this};e.fn.loadChildren=function(t,i,r){var n=this;var a;e.json(t,i,(function(e){n.setChildren(e);a=e;if(r!=undefined)r(a)}));return this};e((function(){e.each(["show","hide","toggleClass","addClass","removeClass"],(function(){var t=e.fn[this];e.fn[this]=function(){var i=this.find(":hidden").add(this.filter(":hidden"));var r=this.find(":visible").add(this.filter(":visible"));var n=t.apply(this,arguments);i.filter(":visible").each((function(){e(this).triggerHandler("show")}));r.filter(":hidden").each((function(){e(this).triggerHandler("hide")}));return n}}))}));e.fn.insertAtCursor=function(e){var t=this.getCursorPosition();var i=this.val();this.val(i.substr(0,t)+e+i.substr(t))};e.fn.getCursorPosition=function(){var t=e(this).get(0);var i=0;if("selectionStart"in t){i=t.selectionStart}else if("selection"in document){t.focus();var r=document.selection.createRange();var n=document.selection.createRange().text.length;r.moveStart("character",-t.value.length);i=r.text.length-n}return i};e.fn.bookmarkOnClick=function(){this.click((function(){if("sidebar"in window&&"addPanel"in window.sidebar){window.sidebar.addPanel(location.href,document.title,"")}else if(/*@cc_on!@*/false){window.external.AddFavorite(location.href,document.title)}else{alert("Press "+(navigator.userAgent.toLowerCase().indexOf("mac")!=-1?"Command/Cmd":"CTRL")+" + D to bookmark this page.")}}))};e.fn.customCreate=function(e){var t=e.create;if(t===undefined)return;this.attr("customCreate",t);this.run(t,e)};e.fn.run=function(){var e=Array.prototype.slice.call(arguments);var t=e.shift();this[t].apply(this,e)};e.fn.call=function(e,t){this[e].apply(this,t)};e.fn.scrollHeight=function(){return this[0].scrollHeight};e.fn.hasScrollBar=function(){return this[0].scrollHeight>this.height()};e.scrollbarWidth=function(){var t,i,r;t=e('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");i=t.children();r=i.innerWidth()-i.height(99).innerWidth();t.remove();return r};e.fn.replace=function(t,i,r){var n=function(e,t,i,r){if(!e||typeof t==="undefined"){return}var a=typeof e=="string"?new RegExp(e,"g"):e;var s=i.childNodes;var o=s.length;var d=typeof r=="undefined"?"html,head,style,title,link,meta,script,object,iframe,pre,a,":r;while(o--){var f=s[o];if(f.nodeType===1&&true||d.indexOf(f.nodeName.toLowerCase())===-1){n(e,t,f,d)}if(f.nodeType!==3||!a.test(f.data)){continue}var l=function(){var e=f.data.replace(a,t);var i=document.createElement("span");var r=document.createDocumentFragment();i.innerHTML=e;while(i.firstChild){r.appendChild(i.firstChild)}return r}();var u=f.parentNode;u.insertBefore(l,f);u.removeChild(f)}};return this.each((function(){n(t,i,e(this).get(0),r)}))};e.fn.valueFromCurrency=function(){return this.value().replace(/[^\d.]/g,"")};e.fn.bindFirst=function(t,i){this.on(t,i);return this.each((function(){var i=e._data(this,"events")[t.split(".")[0]];var r=i.pop();i.splice(0,0,r)}))};e.fn.findByAttribute=function(e,t){return this.find("["+e+"='"+escape(t)+"']")};e.fn.addStyle=function(t,i){if(!e.isArray(t))t=t.split(/[, ]/);var r=[];var n=[];var a=[];if(!i)i=this.data("didi-field").style;t.forEach((function(t){r.push(t);var o=i[t];if(!o)return;if(e.isPlainObject(o)){a.push(o.style);o=o.class}if(!o)return;o.forEach((function(e){if(e[0]=="~")s.removeStyle(i,e.substr(1));else if(e[0]=="^")n.push(e.substr(1));else r.push(e)}))}));if(r.length)this.addClass(r.join(" "));if(n.length)this.removeClass(n.join(" "));if(!a.length)return this;var s=this;a.forEach((function(e){this.css(e)}));return this};e.fn.removeStyle=function(t,i){if(!e.isArray(t))t=t.split(" ");if(!i)i=this.data("didi-field").style;var r=this;t.forEach((function(e){r.removeClass(e);var t=i[e];if(!t)return;t.forEach((function(e){r.removeClass(e)}))}));return this};e.fn.setClass=function(e,t){if(e===undefined)return;if(typeof e==="string")e=e.split(" ");var i=[],r=[];for(var n in e){var a=e[n];if(!a)continue;a[0]=="^"||a[0]=="-"?i.push(a.substr(1)):r.push(a)}if(t){var s=r;r=i;i=s}this.addClass(r.join(" "));this.removeClass(i.join(" "));return this};e.fn.unsetClass=function(e){return this.setClass(e,true)};e.fn.getQuantity=function(e,t){var i=this.data(e);if(i===undefined)return t||0;return parseInt(i)};e.fn.load=function(t){e.showPage(t,this).done((function(e,t,i){setStyle(e,i);setClass(e,i);this.trigger("dying");this.replaceWith(e)}))};e.fn.getAttributes=function(e){var t={};if(e){for(var i=0;i<e.length;++i){var r=e[i];t[r]=r=="text"?this.text():this.attr(r)}}else{var n=this[0].attributes;for(var i=0;i<n.length;++i){t[n[i].name]=n[i].value}}return t};e.fn.enableWhen=function(e){if(e())this.attr("disabled","disabled");else this.removeAttr("disabled")};e.fn.enableOnSet=function(t,i){this.attr("disabled","disabled");t=e(t).filter(":visible").filter("input,select,textarea");var r=this;t.bind("keyup input cut paste click change onClose",(function(){var i=0;t.each((function(){if(e(this).val()!="")++i}));if(i<t.length)r.attr("disabled","disabled");else r.removeAttr("disabled")}))};e.send=function(t,i,r){if(i instanceof Function){r=i;i=undefined}i=e.extend({progress:"Processing...",method:"post",async:true,showResult:false,invoker:undefined,data:{},eval:true,dataType:undefined,error:undefined,event:undefined},i);var n=this;if(i.invoker!==undefined)i.invoker.prop("disabled",true);var a={};if(i.progress!==false){a.box=e(".processing");a.box.click((function(){e(this).fadeOut("slow")}));a.timeout=setTimeout((function(){a.box.find(".message").text(i.progress);a.box.show()}),1e3);if(i.error===undefined){i.error=function(e,t,r){console.log("AJAX ERROR",t,"TEXT",r);a.box.html("<p class=error>Status:"+t+"<br>Text:"+r+"</p").show();if(i.event!==undefined){i.event.stopImmediatePropagation();n=false}}}}e.ajax({type:i.method,url:t,data:i.data,async:i.async,error:i.error,cache:false,dataType:i.dataType,success:function(e){console.log("AJAX SUCCESS",e);if(a.timeout!==undefined)clearTimeout(a.timeout);if(a.box!==undefined)a.box.hide();if(r!==undefined)r(e,i.event);if(i.invoker!==undefined)i.invoker.prop("disabled",false)}});return n};e.loadPage=(t,i)=>{if(i==undefined)i=e("body");var r=e.Deferred();var n=t.path;if(n[0]==="/")n=t.path.substr(1);var a=e.extend({key:t.key},t.request,{path:n,action:"read"});e.json("/",{data:a},(function(n){i.trigger("server_response",n);if(!n.path)return;n.values=e.extend({},t.values,n.values);r.resolve(n,t)}));return r.promise()};e.createPage=(e,t,i)=>{var r=t.fields.id=e.page_id=t.path.replace("/","_");t.fields.local_id=t.path.split("/").pop();var n=t.fields.values||t.values;if(t.fields.name===undefined)t.fields.name=dd.toTitleCase(t.path.split("/").pop().replace("_"," "));t.fields.path=t.path;t.fields.sub_page=false;t.fields.values=n;var a=new dd.render({invoker:i,types:t.types,id:r,key:e.key,request:e.request});var s=a.render(t,"fields");if(t._responses)a.respond(t);s.addClass("page");if(i&&!s.is("body"))s.appendTo(i);return s},e.showPage=(t,i,r)=>{if(i==undefined){i=t.parent?e(i):e("body")}var n=e.Deferred();var a=function(t,r){var a=e.createPage(r,t,i);if(e.isPlainObject(t.fields.parent))i.setClass(t.fields.parent.class);n.resolve(a,t,r)};if(r)a(r,t);else e.loadPage(t,i).done(a);return n.promise()};e.showDialog=(t,i)=>{if(t[0]==="/")t=t.substr(1);var r=e.extend({path:t},i);var n=e.Deferred();e.loadPage({path:"/modal",show:false}).done((function(t,a){var s=e("<div>");e.showPage(r,s).done((function(r,s){if(s.fields.modal)t.fields=dd.merge(t.fields,s.fields.modal);if(t.fields.title_bar)dd.replaceVars(s.fields,t.fields.title_bar,{recurse:true});if(t.fields.close_button)dd.replaceVars(s.fields,t.fields.close_button,{recurse:true});t=e.createPage(a,t);t.removeAttr("id");var o=t.find(".modal-dialog");o.append(r);o.draggable({handle:".modal-title-bar"});t.appendTo(e("body")).show();n.resolve(o,s,i)}))}));return n.promise()},e.closeDialog=(e,t)=>{if(t)alert(t);var i=e.closest(".modal");i.trigger("closing");if(i.exists())i.remove()},e.json=(t,i,r)=>{if(i instanceof Function){r=i;i={dataType:"json"}}else i=e.extend(i,{dataType:"json"});return e.send(t,i,r)};e.scrollbarWidth=()=>{var t,i,r;t=e('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");i=t.children();r=i.innerWidth()-i.height(99).innerWidth();t.remove();return r};e.loadLink=(t,i)=>e.Deferred((function(r){var n={css:{tag:"link",type:"text/css",selector:"href",rel:"stylesheet"},script:{tag:"script",type:"text/javascript",selector:"src"}};var a=n[i];if(t.indexOf("?")<0){var s=e(a.tag+"["+a.selector+'="'+t+'"]');if(s.exists())return r.resolve(t)}var o=document.createElement(a.tag);delete a.tag;o[a.selector]=t;delete a.selector;e.extend(o,a);o[a.src]=t;o.type=a.type;if(i=="css")o.rel="stylesheet";o.onreadystatechange=o.onload=function(){r.resolve(t)};o.onerror=function(){r.resolve(t)};document.head.appendChild(o)})).promise()})(jQuery);